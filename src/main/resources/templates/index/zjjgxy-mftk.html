<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
        <meta http-equiv="Content-Type" content="application/json;charset=utf-8"/>
		<meta name="renderer" content="webkit">
  		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>资金监管协议展示</title>
		<link rel="stylesheet" type="text/css" href="../static/layui/css/layui.css"/>
		<link rel="stylesheet" type="text/css" href="../static/admin/css/admin.css"/>
	</head>
	<body onload="getzkmxHead()">
        <div class="layui-form column-content-detail">
            <div class="layui-tab">
                <ul class="layui-tab-title">
                    <li id="thirdTitle">交款明细</li>
                </ul>
                <div class="layui-tab-content">

                    <div class="layui-tab-item">
                        <form class="layui-form" id="firstForm">
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label"><b>监管开户行</b></label>
                                    <div class="layui-input-inline">
                                        <input type="text" readonly name="jgkhh-third" id="jgkhh-third" autocomplete="off" class="layui-input" style="width: 290px;border:1px solid #DDD;background-color:#F5F5F5;color:#ACA899;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="float: right;padding-right: 135px">
                                    <label class="layui-form-label">结算账户</label>
                                    <div class="layui-input-inline">
                                        <input type="text" readonly name="jszh-third" id="jszh-third" autocomplete="off" class="layui-input" style="width: 290px;border:1px solid #DDD;background-color:#F5F5F5;color:#ACA899;">
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">监管资金额</label>
                                    <div class="layui-input-inline">
                                        <input type="text" readonly name="jgzje-third" id="jgzje-third" autocomplete="off" class="layui-input" style="width: 290px;border:1px solid #DDD;background-color:#F5F5F5;color:#ACA899;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="float: right;padding-right: 135px">
                                    <label class="layui-form-label">交款金额</label>
                                    <div class="layui-input-inline">
                                        <input type="text" readonly name="xjkje-third" id="xjkje-third" autocomplete="off" class="layui-input" style="width: 290px;border:1px solid #DDD;background-color:#F5F5F5;color:#ACA899;">
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label"><b>退款人姓名</b></label>
                                    <div class="layui-input-inline">
                                        <input type="text" readonly name="jkrxm-third" id="jkrxm-third" autocomplete="off" class="layui-input" style="width: 290px;border:1px solid #DDD;background-color:#F5F5F5;color:#ACA899;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="float: right;padding-right: 135px">
                                    <label class="layui-form-label">证件号码</label>
                                    <div class="layui-input-inline">
                                        <input type="text" readonly name="jkrzjhm-third" id="jkrzjhm-third" autocomplete="off" class="layui-input" style="width: 290px;border:1px solid #DDD;background-color:#F5F5F5;color:#ACA899;">
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">退款银行名</label>
                                    <div class="layui-input-inline">
                                        <input type="text" readonly name="jkryh-third" id="jkryh-third" autocomplete="off" class="layui-input" style="width: 290px;border:1px solid #DDD;background-color:#F5F5F5;color:#ACA899;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="float: right;padding-right: 135px">
                                    <label class="layui-form-label">退款人账户</label>
                                    <div class="layui-input-inline">
                                        <input type="text" readonly name="jkrzh-third" id="jkrzh-third" autocomplete="off" class="layui-input" style="width: 290px;border:1px solid #DDD;background-color:#F5F5F5;color:#ACA899;">
                                    </div>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label class="layui-form-label">退款确认额</label>
                                    <div class="layui-input-inline">
                                        <input type="text" readonly name="jkqre-third" id="jkqre-third" autocomplete="off" class="layui-input" style="width: 290px;border:1px solid #DDD;background-color:#F5F5F5;color:#ACA899;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="float: right;padding-right: 135px">
                                    <label class="layui-form-label">撤销密码</label>
                                    <div class="layui-input-inline">
                                        <input type="password" name="cxmm-third" id="cxmm-third" autocomplete="off" lay-verify="cxmm" class="layui-input" style="width: 290px">
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div class="layui-form-item">
                                <div class="layui-inline">
                                    <label style="padding-left: 25px"><b>交款明细记录</b></label>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <table class="layui-hide" id="test" lay-filter="test"></table>
                            </div>
                            <hr>
                            <div class="layui-form-item" style="padding-left: 10px;">
                                <div class="layui-input-block" style="float: right">
                                    <button type="button" class="layui-btn layui-btn-normal" onclick="window.print()">打印</button>
                                    <button type="button" class="layui-btn layui-btn-normal" lay-submit="" id="mftkCx" lay-filter="demo1">确认撤销</button>
                                    <a type="button" class="layui-btn layui-btn-normal" href="../zjjgx/helpDownload">帮助</a>
                                    <button type="button" class="layui-btn layui-btn-normal" id="closeThird">关闭</button>
                                </div>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
	</body>
    <script src="../static/login/js/jquery-2.1.1.min.js"></script>
    <script src="../static/js/jquery.jqprint-0.3.js"></script>
<!--	<script src="../static/admin/layui/layui.js" type="text/javascript" charset="utf-8"></script>-->
    <script src="../static/layui/layui.js"></script>
	<script src="../static/admin/js/common.js" type="text/javascript" charset="utf-8"></script>

    <script>
        //点击关闭按钮，关闭页面
        var index = parent.layer.getFrameIndex(window.name);//获取窗口索引
        $('#closeThird').click(function () {
            //父页面撤销结果赋值
            $(window.parent.document).find('#cxjg').val('取消撤销操作');
            parent.layer.close(index);
        });
    </script>

    <script>
        //获取退款数据-撤销用
        function getzkmxHead() {

            layui.use('form',function () {
                var form = layui.form;

                //获取交款明细头部数据-撤销用
                $.ajax({
                    url: '../zjjgx/getjkmxHeadToCx',
                    dataType: 'json',
                    success: function (obj) {
                        if (obj.success) {
                            //监管开户行
                            $('#jgkhh-third').val(obj.data.jgkhh);
                            //结算账户
                            $('#jszh-third').val(obj.data.jszh);
                            //监管资金额
                            $('#jgzje-third').val(obj.data.jgzje);
                            //需交款金额
                            $('#xjkje-third').val(obj.data.jgzje);
                            //交款确认额
                            $("#jkqre-third").val(obj.data.jgzje);
                            //交款人姓名
                            $("#jkrxm-third").val(obj.data.jkrxm);
                            //交款人证件号码
                            $("#jkrzjhm-third").val(obj.data.jkrzjhm);
                            //交款银行名
                            $("#jkryh-third").val(obj.data.jkryh);
                            //交款人账户
                            $("#jkrzh-third").val(obj.data.jkrzh);
                        } else {
                            layer.alert(obj.msg);
                        }
                    },
                    error: function () {
                        layer.alert("后端请求参数错误，请重试");
                    }
                });

                //交款明细记录数据-撤销用
                layui.use('table', function() {
                    var table = layui.table;
                    table.render({
                        elem: '#test'
                        ,url:'../zjjgx/findJkmxByXybhToCx'
                        ,cols: [
                            [
                                {field:'', title:'序号', width:80,type:'numbers', fixed: 'left'}
                                ,{field:'jkrq', title:'交款日期'}
                                ,{field:'jkje', title:'交款金额'}
                                ,{field:'pos', title:'POS机交款'}
                                ,{field:'ljjkje', title:'累计交款金额'}
                                ,{field:'sfwcjk', title:'是否完成交款'}
                                ,{field:'yhjyls', title:'银行交易流水'}
                            ]
                        ]
                    });
                });

                //方法中点击一次标题，进行数据显示
                $("#thirdTitle").click();
            });
        };

    </script>

    <script>
        layui.use('form',function () {
            var form = layui.form;

            //自定义验证
            form.verify({
                cxmm: [
                    /[0-9]{3,6}$/
                    ,"<em style='color: #74CBB5'>" + "撤销密码必须是3到6位无空格的纯数字" + "</em>"
                ]
            });

            //买方退款和撤销
            form.on('submit(demo1)', function(){
                var cxmm = $("#cxmm-third").val();
                $.ajax({
                    url: '../zjjgx/mftkCx',
                    data: {'cxmm':cxmm},
                    type: 'post',
                    dataType: 'json',
                    success: function (obj) {
                        if (obj.success){ //撤销和退款成功
                            layer.alert(obj.msg,'',function () {
                                //父页面撤销结果赋值
                                $(window.parent.document).find('#cxjg').val(obj.msg);
                                var index = parent.layer.getFrameIndex(window.name);
                                parent.layer.close(index);//关闭当前页
                            });
                        }else {
                            layer.alert(obj.msg,'',function () {
                                //父页面撤销结果赋值
                                $(window.parent.document).find('#cxjg').val(obj.msg);
                                location.reload();
                            });
                        }
                    },
                    error: function () {
                        layer.alert("后端请求错误，请重试",'',function () {
                            //父页面撤销结果赋值
                            $(window.parent.document).find('#cxjg').val(obj.msg);
                            location.reload();
                        });
                    }
                });
            });

        });

    </script>
</html>